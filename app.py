import streamlit as st

# ç”¨äºå­˜å‚¨ç”¨æˆ·é€‰æ‹©çŠ¶æ€
if "step" not in st.session_state:
    st.session_state.step = 0
if "fail" not in st.session_state:
    st.session_state.fail = False

# å¤šæ­¥é€‰æ‹©é¢˜å‡½æ•°
def choose(question, opts, correct, step_key):
    st.write(question)
    choice = st.radio("è¯·é€‰æ‹©ï¼š", list(opts.keys()), format_func=lambda x: f"{x}. {opts[x]}", key=f"radio_{step_key}")
    if st.button("ç¡®è®¤", key=f"btn_{step_key}"):
        if choice != correct:
            st.session_state.fail = True
        else:
            st.session_state.step += 1

def main():
    st.title("ğŸº ç“¶ç›–é£è¿›èœé‡Œ Â· äº’åŠ¨å‰§æœ¬")

    if st.session_state.fail:
        st.error("ğŸ‘¿ å¯¹æ–¹çº¢æ¸©ï¼Œé¥­å±€æå‰ç»“æŸï¼")
        if st.button("ğŸ” é‡æ–°å¼€å§‹"):
            st.session_state.step = 0
            st.session_state.fail = False
            st.experimental_rerun()
        st.stop()

    step = st.session_state.step

    if step == 0:
        st.write("ä½ å¼€ç“¶ç›–ï¼Œâ€œå•ªâ€ä¸€å£°ï¼Œç“¶ç›–é£åˆ°å¯¹æ–¹çš„èœé‡Œã€‚")
        st.write("å¯¹æ–¹ï¼š**â€œberå“¥ä»¬å’‹å¼€çš„ç“¶ç›–å•Šï¼Ÿéƒ½å¼€æˆ‘èœé‡Œå•¦ï¼â€**")
        choose(
            "ä½ è¦æ€ä¹ˆå›åº”ï¼Ÿ",
            {
                "1": "å¯¹ä¸èµ·å“¥ä»¬ï¼Œæˆ‘ç»™ä½ æ¢ä¸€ç›˜å§ï¼Œå®åœ¨å¯¹ä¸ä½ã€‚",
                "2": "æ€ªæˆ‘å’¯ï¼Ÿä½ è‡ªå·±åå¤ªè¿‘äº†å§ã€‚",
                "3": "å¼€ä¸ªç“¶ç›–éƒ½ä¸è¡Œï¼Ÿæˆ‘è¿˜ä¸èƒ½åƒé¥­äº†ï¼Ÿ"
            },
            "1",
            step_key=0
        )

    elif step == 1:
        st.write("å¯¹æ–¹ï¼šä½ éƒ½è¿™ä¹ˆè¯´äº†é‚£è¿˜è¯´å•¥äº†ï¼Ÿæ‹¿å‡ºæ¥æ‰”äº†å°±å®Œäº‹äº†å‘—")
        choose(
            "ä½ æ¥ç€æ€ä¹ˆè¯´ï¼Ÿ",
            {
                "1": "å®åœ¨æ˜¯ä¸å¥½æ„æ€",
                "2": "ä½ è®¡è¾ƒå¤ªå¤šäº†å§",
                "3": "èœåˆæ²¡åï¼Œä¸è‡³äºå§"
            },
            "1",
            step_key=1
        )

    elif step == 2:
        st.write("---")
        st.write("å¯¹æ–¹å‘æœ‹å‹å€ŸçƒŸï¼Œæœ‹å‹è¯´ï¼šæ²¡æœ‰")
        choose(
            "ä½ å¬åˆ°äº†ï¼Œæ‰“ç®—å¸®å¿™å—ï¼Ÿ",
            {
                "1": "æ˜¯ï¼Œèµ·èº«å»åå¤‡ç®±æ‹¿çƒŸ",
                "2": "å¦ï¼Œç»§ç»­åƒé¥­æ²¡å¬åˆ°"
            },
            "1",
            step_key=2
        )

    elif step == 3:
        choose(
            "ä½ ä¼šæ€ä¹ˆåšï¼Ÿ",
            {
                "1": "å“¥ä»¬ï¼Œæˆ‘è¿™å„¿æ­£å¥½æœ‰çƒŸï¼ä½ å…ˆæŠ½ç€",
                "2": "è¿™ç‚¹äº‹ä¹Ÿå€¼å¾—å«æœåŠ¡å‘˜ï¼Ÿ",
                "3": "ä½ æŠ½ä¸æŠ½å…³æˆ‘å•¥äº‹ï¼Ÿ"
            },
            "1",
            step_key=3
        )

    elif step == 4:
        st.write("å¯¹æ–¹ï¼šè¿™å¤šä¸å¥½æ„æ€ï¼Œè°¢è°¢æ˜‚")
        choose(
            "ä½ æ€ä¹ˆå›åº”ï¼Ÿ",
            {
                "1": "ç»™ä½ å°±æ‹¿ç€ï¼Œåˆ«é€¼é€¼",
                "2": "å¤§å®¶éƒ½æ˜¯å¼—é›·å°”å“å¾·äººï¼Œæ²¡æœ‰é‚£äº›ä¸ª",
                "3": "é‚£ä½ è¿˜æˆ‘"
            },
            "2",
            step_key=4
        )

    elif step == 5:
        st.success("ğŸµ BGM: æç€æ˜¨æ—¥ç§ç§åƒè¾›ä¸‡è‹¦â€¦")
        st.write("å¯¹æ–¹ï¼šä½ è¯´è¿™æ‰¯ä¸æ‰¯ï¼Ÿ")
        choose(
            "ä½ è¦æ€ä¹ˆå›åº”ï¼Ÿ",
            {
                "1": "è¿™çœŸæŒºæ‰¯çš„å“ˆå“ˆ",
                "2": "ä½ è‡ªå·±æƒ³æƒ³è°é”™ï¼Ÿ",
                "3": "å“¥ä»¬å’±æ²¡å•¥èŠçš„"
            },
            "1",
            step_key=5
        )

    elif step == 6:
        st.write("å¯¹æ–¹ï¼šè¡Œå“¥ä»¬ï¼Œä½ å…ˆåƒæˆ‘ä»¬èµ°äº†æ˜‚")
        st.write("æˆ‘ï¼šæœåŠ¡å‘˜ï¼Œä¹°å•")
        st.write("æœåŠ¡å‘˜ï¼šä¹°è¿‡å•äº†å“¥")
        st.write("æœ‹å‹ï¼šæˆ‘æ²¡ä¹°å•Š")
        st.write("æœåŠ¡å‘˜ï¼šåˆšæ‰åé¢é‚£æ¡Œä¸€èµ·ç»“çš„ã€‚")
        choose(
            "ä½ æœ€åè¦è¯´ä»€ä¹ˆï¼Ÿ",
            {
                "1": "å“ï¼Œå…„å¼Ÿï¼ğŸ™",
                "2": "çœ‹ä¸å‡ºæ¥ä½ è¿˜æœ‰ç‚¹äººæƒ…å‘³å„¿",
                "3": "ä½ æ˜¯ä¸æ˜¯å›¾ä»€ä¹ˆå•Šï¼Ÿç»“è´¦å¹²å˜›ï¼Ÿ"
            },
            "1",
            step_key=6
        )

    elif step == 7:
        st.balloons()
        st.success("ğŸ‰ å‰§æœ¬ç»“æŸï¼Œå®Œç¾è½å¹•ï¼")
        if st.button("ğŸ” é‡æ–°å¼€å§‹"):
            st.session_state.step = 0
            st.experimental_rerun()

if __name__ == "__main__":
    main()
